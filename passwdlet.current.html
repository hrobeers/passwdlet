<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
	<head>
		<title>Password generator bookmarklet</title>
		<link rel="StyleSheet" href="main.css" type="text/css" />
	</head>
	<body>
		<ul id="menu"><li><a href="./">Nic's tricks</a></li></ul>
		<h1>Password generator bookmarklet</h1>
		<p><b>I hate passwords.</b> I mean, I don't mind making up and memorizing the really important ones but what about all those e-commerce and community sites that want me to create accounts? I used to end up using the same password at all of them and then I felt stupid knowing that one SQL Server exploit or disgruntled admin could cost me my whole identity.</p>
		<p>So, I wrote a bookmarklet to make up passwords for me. It asks for my master password, which is all I have to remember, and uses it to make a unique password for each site. It even types the password into any password fields on the current page for me, whether I'm registering for a new account or logging in on a subsequent visit.</p>
		<p class="callout"><b>Here's the bookmarklet:</b>
		<a id="bookmarklet" href="javascript:var%20b64pad='';var%20chrsz=8;function%20b64_sha1(s)%7Breturn%20binb2b64(core_sha1(str2binb(s),s.length*chrsz));%7Dfunction%20core_sha1(x,len)%7Bx%5Blen%3E%3E5%5D%7C=0x80%3C%3C(24-len);x%5B((len+64%3E%3E9)%3C%3C4)+15%5D=len;var%20w=Array(80);var%20a=1732584193;var%20b=-271733879;var%20c=-1732584194;var%20d=271733878;var%20e=-1009589776;for(var%20i=0;i%3Cx.length;i+=16)%7Bvar%20olda=a;var%20oldb=b;var%20oldc=c;var%20oldd=d;var%20olde=e;for(var%20j=0;j%3C80;j++)%7Bif(j%3C16)w%5Bj%5D=x%5Bi+j%5D;else%20w%5Bj%5D=rol(w%5Bj-3%5D%5Ew%5Bj-8%5D%5Ew%5Bj-14%5D%5Ew%5Bj-16%5D,1);var%20t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w%5Bj%5D),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t;%7Da=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde);%7Dreturn%20Array(a,b,c,d,e);%7Dfunction%20sha1_ft(t,b,c,d)%7Bif(t%3C20)return%20(b&c)%7C((~b)&d);if(t%3C40)return%20b%5Ec%5Ed;if(t%3C60)return%20(b&c)%7C(b&d)%7C(c&d);return%20b%5Ec%5Ed;%7Dfunction%20sha1_kt(t)%7Breturn%20(t%3C20)?1518500249:(t%3C40)?1859775393:(t%3C60)?-1894007588:-899497514;%7Dfunction%20safe_add(x,y)%7Bvar%20lsw=(x&0xFFFF)+(y&0xFFFF);var%20msw=(x%3E%3E16)+(y%3E%3E16)+(lsw%3E%3E16);return%20(msw%3C%3C16)%7C(lsw&0xFFFF);%7Dfunction%20rol(num,cnt)%7Breturn%20(num%3C%3Ccnt)%7C(num%3E%3E%3E(32-cnt));%7Dfunction%20str2binb(str)%7Bvar%20bin=Array();var%20mask=(1%3C%3Cchrsz)-1;for(var%20i=0;i%3Cstr.length*chrsz;i+=chrsz)bin%5Bi%3E%3E5%5D%7C=(str.charCodeAt(i/chrsz)&mask)%3C%3C(24-i);return%20bin;%7Dfunction%20binb2b64(binarray)%7Bvar%20tab='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';var%20str='';for(var%20i=0;i%3Cbinarray.length*4;i+=3)%7Bvar%20triplet=(((binarray%5Bi%3E%3E2%5D%3E%3E8*(3-i%254))&0xFF)%3C%3C16)%7C(((binarray%5Bi+1%3E%3E2%5D%3E%3E8*(3-(i+1)%254))&0xFF)%3C%3C8)%7C((binarray%5Bi+2%3E%3E2%5D%3E%3E8*(3-(i+2)%254))&0xFF);for(var%20j=0;j%3C4;j++)%7Bif(i*8+j*6%3Ebinarray.length*32)str+=b64pad;else%20str+=tab.charAt((triplet%3E%3E6*(3-j))&0x3F);%7D%7Dreturn%20str;%7Dfunction%20doIt()%7Bvar%20master=window.prompt('Enter%20your%20master%20password');if(master!=''&&master!=null)%7Bhost=document.location.href.match(/http(s*):%5C/%5C/(%5B%5E/%5D+)/)%5B2%5D;if(sld=host.match(/(%5B%5E.%5D+%5C.(%5Ba-z%5D%5Ba-z%5D%5Ba-z%5D+%7Ca(m%7Cs%7Cx)%7Cbg%7Cc(f%7Cl%7Cz)%7Cd(e%7Cj%7Ck)%7Ceu%7Cfm%7Cfo%7Cgl%7Cgm%7Chm%7Cio%7Ckm%7Cla%7Cly%7Cm(d%7Ce%7Cn%7Cp%7Cq%7Cr)%7Cnc%7Cnu%7Cs(i%7Cm%7Cn%7Cr%7Ct%7Cu%7Cz)%7Ctd%7Ctk%7Cuz%7Cvc%7Cvu%7Cws))$/i))%7Bdomain=sld%5B0%5D;%7Delse%7Bdomain=host.match(/(%5B%5E.%5D+%5C.%5B%5E.%5D+%5C.%5Ba-z%5D%5Ba-z%5D)$/i)%5B0%5D;%7Dvar%20i=0,j=0,p=b64_sha1(master+':'+domain).substr(0,8)+'1a',F=document.forms,g=false;for(i=0;i%3CF.length;i++)%7BE=F%5Bi%5D.elements;for(j=0;j%3CE.length;j++)%7BD=E%5Bj%5D;if(D.type=='password')%7BD.value=p;D.focus();g=true;%7Dif(D.type=='text')%7Bif(D.name.toUpperCase().indexOf('PASSWORD')!=-1%7C%7CD.name.toUpperCase().indexOf('PASSWD')!=-1)%7BD.value=p;D.focus();g=true;%7D%7D%7D%7Dif(!g)%7Bwindow.prompt('Your%20password%20for%20'+domain+'%20is',p)%7D%7D%7DdoIt();void(null);">Generate password</a>. You can drag it to your browser's bookmark list or button bar to keep it handy. Or just click it right now to test it on the form below.</p>
		<p><b>How does it work?</b> It gets the domain name from the page's URL and mixes it together with your personal master password using a little cryptographic magic we call <a href="http://en.wikipedia.org/wiki/SHA-1">SHA-1</a>. It will always get the same result if given that domain name and master password, but will never get that result if either changes. (Well, once in a few billion times it might.)</p>
		<p>Oh, and the SHA-1 Javascript code is &copy; <a href="http://pajhome.org.uk/crypt/md5/">Paul Johnston</a> 1999-2002.</p>
		<p><b>Here's a sample form</b> to test the bookmarklet on:</p>

		<form action="foo.html" method="get" class="callout">
			<table>
				<tr><td align="right">Here's a plain text field that won't be affected: </td><td><input name="name" /></td></tr>
				<tr><td align="right">Here's a password field:</td><td><input type="password" name="pass" /></td></tr>
				<tr><td align="right">Here's a text field named &quot;password&quot;:</td><td><input name="password" /></td></tr>
			</table>
		</form>

		<p><a id="bookmarklet2" href="javascript:var%20b64pad='';var%20chrsz=8;function%20b64_sha1(s)%7Breturn%20binb2b64(core_sha1(str2binb(s),s.length*chrsz));%7Dfunction%20core_sha1(x,len)%7Bx%5Blen%3E%3E5%5D%7C=0x80%3C%3C(24-len);x%5B((len+64%3E%3E9)%3C%3C4)+15%5D=len;var%20w=Array(80);var%20a=1732584193;var%20b=-271733879;var%20c=-1732584194;var%20d=271733878;var%20e=-1009589776;for(var%20i=0;i%3Cx.length;i+=16)%7Bvar%20olda=a;var%20oldb=b;var%20oldc=c;var%20oldd=d;var%20olde=e;for(var%20j=0;j%3C80;j++)%7Bif(j%3C16)w%5Bj%5D=x%5Bi+j%5D;else%20w%5Bj%5D=rol(w%5Bj-3%5D%5Ew%5Bj-8%5D%5Ew%5Bj-14%5D%5Ew%5Bj-16%5D,1);var%20t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w%5Bj%5D),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t;%7Da=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde);%7Dreturn%20Array(a,b,c,d,e);%7Dfunction%20sha1_ft(t,b,c,d)%7Bif(t%3C20)return%20(b&c)%7C((~b)&d);if(t%3C40)return%20b%5Ec%5Ed;if(t%3C60)return%20(b&c)%7C(b&d)%7C(c&d);return%20b%5Ec%5Ed;%7Dfunction%20sha1_kt(t)%7Breturn%20(t%3C20)?1518500249:(t%3C40)?1859775393:(t%3C60)?-1894007588:-899497514;%7Dfunction%20safe_add(x,y)%7Bvar%20lsw=(x&0xFFFF)+(y&0xFFFF);var%20msw=(x%3E%3E16)+(y%3E%3E16)+(lsw%3E%3E16);return%20(msw%3C%3C16)%7C(lsw&0xFFFF);%7Dfunction%20rol(num,cnt)%7Breturn%20(num%3C%3Ccnt)%7C(num%3E%3E%3E(32-cnt));%7Dfunction%20str2binb(str)%7Bvar%20bin=Array();var%20mask=(1%3C%3Cchrsz)-1;for(var%20i=0;i%3Cstr.length*chrsz;i+=chrsz)bin%5Bi%3E%3E5%5D%7C=(str.charCodeAt(i/chrsz)&mask)%3C%3C(24-i);return%20bin;%7Dfunction%20binb2b64(binarray)%7Bvar%20tab='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';var%20str='';for(var%20i=0;i%3Cbinarray.length*4;i+=3)%7Bvar%20triplet=(((binarray%5Bi%3E%3E2%5D%3E%3E8*(3-i%254))&0xFF)%3C%3C16)%7C(((binarray%5Bi+1%3E%3E2%5D%3E%3E8*(3-(i+1)%254))&0xFF)%3C%3C8)%7C((binarray%5Bi+2%3E%3E2%5D%3E%3E8*(3-(i+2)%254))&0xFF);for(var%20j=0;j%3C4;j++)%7Bif(i*8+j*6%3Ebinarray.length*32)str+=b64pad;else%20str+=tab.charAt((triplet%3E%3E6*(3-j))&0x3F);%7D%7Dreturn%20str;%7Dfunction%20doIt()%7Bvar%20master='MASTER_PASSWORD';if(master!=''&&master!=null)%7Bhost=document.location.href.match(/http(s*):%5C/%5C/(%5B%5E/%5D+)/)%5B2%5D;if(sld=host.match(/(%5B%5E.%5D+%5C.(%5Ba-z%5D%5Ba-z%5D%5Ba-z%5D+%7Ca(m%7Cs%7Cx)%7Cbg%7Cc(f%7Cl%7Cz)%7Cd(e%7Cj%7Ck)%7Ceu%7Cfm%7Cfo%7Cgl%7Cgm%7Chm%7Cio%7Ckm%7Cla%7Cly%7Cm(d%7Ce%7Cn%7Cp%7Cq%7Cr)%7Cnc%7Cnu%7Cs(i%7Cm%7Cn%7Cr%7Ct%7Cu%7Cz)%7Ctd%7Ctk%7Cuz%7Cvc%7Cvu%7Cws))$/i))%7Bdomain=sld%5B0%5D;%7Delse%7Bdomain=host.match(/(%5B%5E.%5D+%5C.%5B%5E.%5D+%5C.%5Ba-z%5D%5Ba-z%5D)$/i)%5B0%5D;%7Dvar%20i=0,j=0,p=b64_sha1(master+':'+domain).substr(0,8)+'1a',F=document.forms,g=false;for(i=0;i%3CF.length;i++)%7BE=F%5Bi%5D.elements;for(j=0;j%3CE.length;j++)%7BD=E%5Bj%5D;if(D.type=='password')%7BD.value=p;D.focus();g=true;%7Dif(D.type=='text')%7Bif(D.name.toUpperCase().indexOf('PASSWORD')!=-1%7C%7CD.name.toUpperCase().indexOf('PASSWD')!=-1)%7BD.value=p;D.focus();g=true;%7D%7D%7D%7Dif(!g)%7Bwindow.prompt('Your%20password%20for%20'+domain+'%20is',p)%7D%7D%7DdoIt();void(null);">Here's</a> a version of the bookmarklet that has a hard-coded MASTER_PASSWORD (which you'd replace with your own), so it fills in the passwords on the current page as soon as it's clicked or selected. Of course, anyone with access to your workstation can use it, and your master password will be stored in the clear in your bookmarks list. Still, mighty handy.</p>

		<p><b>Other versions</b></p>

		<p>It can be difficult to save a bookmarklet on a mobile device. <a href="javascript:window.location=window.location+'#'+document.getElementById('bookmarklet').href">If you click here</a> the bookmarklet will be appended to the current page URL, which you can then bookmark and edit to remove everything up to the "#".</p>

		<p><a href="passwdlet.domain.html">Here's</a> an page for an older version of the bookmarklet that didn't have ".ly" or ".me" in its list of domains that allow organizations under the TLD.</p>

		<p><a href="passwdlet.sha1.1a.html">Here's</a> an page for an older version of the bookmarklet that used the whole hostname rather than the domain part, which didn't work well for sites that use a separate "login" or "register" hostname.</p>

		<p class="callout">If you've been using that version and want to use this instead - and you really should! - you'll have to update all the passwords you've already set. I wish there were a way around this but it's the price of simplicity!</p>

		<p>And <a href="passwd.current.html">here's</a> an HTML/Javascript form that will let you generate passwords for things besides the current site.</p>

		<p>Billiam wrote a version as a <a href="http://www.chromeextensions.org/utilities/quick-password-generator/">a Google Chrome extension</a>.</p>
	</body>
</html>

