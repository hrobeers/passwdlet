<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
	<head>
		<title>Password generator bookmarklet</title>
		<link rel="StyleSheet" href="main.css" type="text/css" />
	</head>
	<body>
		<h1>Password generator bookmarklet</h1>
		<p><b>I hate passwords.</b> I mean, I don't mind making up and memorizing the really important ones but what about all those e-commerce and community sites that want me to create accounts? I used to end up using the same password at all of them and then I felt stupid knowing that one SQL Server exploit or disgruntled admin could cost me my whole identity.</p>
		<p>So, I wrote a bookmarklet to make up passwords for me. It asks for my master password, which is all I have to remember, and uses it to make a unique password for each site. It even types the password into any password fields on the current page for me, whether I'm registering for a new account or logging in on a subsequent visit.</p>
		<p class="callout"><b>Here's the bookmarklet:</b>
		<a id="bookmarklet" href="javascript:var b64pad='';var chrsz=8;function b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length*chrsz))}function core_sha1(x,f){x[f>>5]|=0x80<<(24-f);x[((f+64>>9)<<4)+15]=f;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var g=a;var h=b;var k=c;var l=d;var m=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,g);b=safe_add(b,h);c=safe_add(c,k);d=safe_add(d,l);e=safe_add(e,m)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return(b&c)|((~b)&d);if(t<40)return b^c^d;if(t<60)return(b&c)|(b&d)|(c&d);return b^c^d}function sha1_kt(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514}function safe_add(x,y){var a=(x&0xFFFF)+(y&0xFFFF);var b=(x>>16)+(y>>16)+(a>>16);return(b<<16)|(a&0xFFFF)}function rol(a,b){return(a<<b)|(a>>>(32-b))}function str2binb(a){var b=Array();var c=(1<<chrsz)-1;for(var i=0;i<a.length*chrsz;i+=chrsz)b[i>>5]|=(a.charCodeAt(i/chrsz)&c)<<(24-i);return b}function binb2b64(a){var b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#';var c='';for(var i=0;i<a.length*4;i+=3){var d=(((a[i>>2]>>8*(3-i%4))&0xFF)<<16)|(((a[i+1>>2]>>8*(3-(i+1)%4))&0xFF)<<8)|((a[i+2>>2]>>8*(3-(i+2)%4))&0xFF);for(var j=0;j<4;j++){if(i*8+j*6>a.length*32)c+=b64pad;else c+=b.charAt((d>>6*(3-j))&0x3F)}}return c}function generatePassword(a,b){return b64_sha1(a+':'+b).substr(0,10)+'3?k'}function showPasswdlet(){var a=document.location.href.match(/http(s*):\/\/([^/]+)/)[2];var b='';if(sld=a.match(/([^.]+\.([a-z][a-z][a-z]+|a(m|s|x)|bg|c(f|l|z)|d(e|j|k)|eu|fm|fo|gl|gm|hm|io|km|la|ly|m(d|e|n|p|q|r)|nc|nu|s(i|m|n|r|t|u|z)|td|tk|uz|vc|vu|ws))$/i)){b=sld[0].split('.')}else{b=a.split('.')}var c=b.length;var d=b[c-2];if(d.match(/(ac|co)/)!=null){d=b[c-3]}var e=window.prompt('Application',d);if(e!=null&&e!=''){d=e}var f=window.prompt('Enter your master password');if(f!=null&&f!=''){var i=0,j=0,p=generatePassword(f,d),F=document.forms,g=false;for(i=0;i<F.length;i++){E=F[i].elements;for(j=0;j<E.length;j++){D=E[j];if(D.type=='password'){D.value=p;D.focus();g=true}if(D.type=='text'){if(D.name.toUpperCase().indexOf('PASSWORD')!=-1||D.name.toUpperCase().indexOf('PASSWD')!=-1){D.value=p;D.focus();g=true}}}}if(!g){window.prompt('Your password for '+d+' is',p)}}}if(document.title!='Password Generator'){showPasswdlet();void(null)}">Generate Password</a>.
		You can drag it to your browser's bookmark list or button bar to keep it handy. Or just click it right now to test it on the form below.</p>
		<p><b>How does it work?</b> It gets the domain name from the page's URL and mixes it together with your personal master password using a little cryptographic magic we call <a href="http://en.wikipedia.org/wiki/SHA-1">SHA-1</a>. It will always get the same result if given that domain name and master password, but will never get that result if either changes. (Well, once in a few billion times it might.)</p>
		<p>Oh, and the SHA-1 Javascript code is &copy; <a href="http://pajhome.org.uk/crypt/md5/">Paul Johnston</a> 1999-2002.</p>
		<p><b>Here's a sample form</b> to test the bookmarklet on:</p>

		<form action="foo.html" method="get" class="callout">
			<table>
				<tr><td align="right">Here's a plain text field that won't be affected: </td><td><input name="name" /></td></tr>
				<tr><td align="right">Here's a password field:</td><td><input type="password" name="pass" /></td></tr>
				<tr><td align="right">Here's a text field named &quot;password&quot;:</td><td><input name="password" /></td></tr>
			</table>
		</form>
		
		<p><b>Other versions</b></p>

		<p>It can be difficult to save a bookmarklet on a mobile device. <a href="javascript:window.location=window.location+'#'+document.getElementById('bookmarklet').href">If you click here</a> the bookmarklet will be appended to the current page URL, which you can then bookmark and edit to remove everything up to the "#".</p>

		<p>And <a href="password.html">here's</a> an HTML/Javascript form that will let you generate passwords for things besides the current site.</p>

		<p>Billiam wrote a version as a <a href="http://www.chromeextensions.org/utilities/quick-password-generator/">a Google Chrome extension</a>.</p>
	</body>
</html>

